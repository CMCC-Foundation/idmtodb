USE idmdb;

DROP VIEW IF EXISTS `user_gd_idm`;
CREATE VIEW `user_gd_idm` AS (select `tmp_ug1`.`iduser_idm` AS `iduser_idm`,`tmp_ug1`.`username` AS `username`,`tmp_ug1`.`name` AS `name`,`tmp_ug1`.`surname` AS `surname`,`tmp_ug1`.`uid` AS `uid`,`tmp_ug1`.`gid` AS `gid`,`tmp_ug2`.`real_group_name` AS `group_name`,`tmp_ug1`.`real_group_name` AS `division`,`tmp_ug1`.`creation_date` AS `creation_date`,`tmp_ug1`.`expiration_date` AS `expiration_date`,`tmp_ug1`.`vpn_expiration_date` AS `vpn_expiration_date`,`tmp_ug1`.`psw_expiration_date` AS `psw_expiration_date`,`tmp_ug1`.`notification_date` AS `notification_date`,`tmp_ug1`.`email` AS `email`,`tmp_ug1`.`notes` AS `notes`,`tmp_ug1`.`closing_date` AS `closing_date`,`tmp_ug1`.`nsaccount_lock` AS `nsaccount_lock`,`tmp_ug2`.`real_group_name` = 'juno-ext' AS `no_cmcc`,`tmp_ug1`.`closing_date` is null or `tmp_ug1`.`nsaccount_lock` = 1 AS `status` from (`tmp_user_group` `tmp_ug1` join `tmp_user_group` `tmp_ug2` on(`tmp_ug1`.`iduser_idm` = `tmp_ug2`.`iduser_idm` and `tmp_ug1`.`type` = 0 and `tmp_ug2`.`type` = 1)))
